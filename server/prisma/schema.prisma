datasource db { provider = "postgresql" url = env("DATABASE_URL") }
generator client { provider = "prisma-client-js" }

model User {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  devices   Device[]
}

model Device {
  id               String   @id @default(cuid())
  user             User     @relation(fields: [userId], references: [id])
  userId           String
  identityKeyPub   Bytes
  signedPrekeyPub  Bytes
  createdAt        DateTime @default(now())
  oneTimePrekeys   OneTimePrekey[]
}

model OneTimePrekey {
  id        String   @id @default(cuid())
  device    Device   @relation(fields: [deviceId], references: [id])
  deviceId  String
  keyPub    Bytes
  used      Boolean  @default(false)
}

model Envelope {
  id           String   @id @default(cuid())
  toDeviceId   String
  ciphertext   Bytes
  contentType  String
  createdAt    DateTime @default(now())
  deliveredAt  DateTime?
  expiresAt    DateTime
  @@index([toDeviceId, createdAt])
}

model Attachment {
  id          String   @id @default(cuid())
  objectKey   String   @unique
  sha256      String
  size        Int
  contentType String
  createdAt   DateTime @default(now())
}
